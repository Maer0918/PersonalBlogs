##  欢迎进入 Node.js 的世界

- [x] Node.js 是什么 [->](#a1)
- [ ] 定义 Node 应用程序
- [ ] 使用 Node 的优势
- [ ] 异步和非阻塞 I/O

<h3 id="a1">Node.js 是什么</h3>
Node.js 是一个 JavaScript 运行平台,其显著特征是它的异步和事件驱动机制,以及小巧精悍
的标准库。

###  一个典型的 Node Web 应用程序

大体上来说，Node 和 JavaScript 的优势之一是它们的单线程编程模型。

在为浏览器编写代码时，我们写的指令序列一次执行一条，代码不是并行执行的。然而对于用户界面来说，这样是不合理的：没有哪个用户想在浏览器执行网络访问或文件获取这样的低速操作时干等着。

为了解决这个问题，浏览器引入了事件机制：在你点击按钮时，就有一个事件被触发，还有一个之前定义的函数会跑起来。这种机制可以规避一些在线程编程中经常出现的问题，比如资源死锁和竞态条件。

####  非阻塞 I/O

在服务器编程的时候，情况和平时差不多：访问磁盘和网络这样的 I/O 请求会比较慢，所以我们希望，在读取文件或通过网络发送信息时，运行平台不会阻塞业务逻辑的执行。

Node 用三种技术来解决这个问题：事件、异步 API、非阻塞 I/O。

在 Node 程序员看来，非阻塞 I/O 是个底层术语。它的意思是说，你的程序可以在做其他事情时发起一个请求来获取网络资源，然后当网络操作完成时，将会运行一个回调函数来处理这个操作的结果。

*[怎样理解阻塞非阻塞与同步异步的区别？——知乎](https://www.zhihu.com/question/19732473)*

Node 中的网络访问是非阻塞的，它用一个名为 libuv 的库来访问操作系统的非阻塞网络调用。

访问硬盘也差不多，但又不完全一样。在生成了回执邮件并从硬盘中读取邮件模板时，libuv 借助线程池模拟出了一种使用非阻塞调用的假象。

**在进行速度较慢的处理时让 Node 能做其他事情，是使用带非阻塞 I/O 的异步 API 的真正好处。**

**即便你只有一个单线程、单进程的 Node Web 应用，它也可以同时处理上千个网站访客发起的连接。要想知道 Node 是如何做到的，得先研究一下事件轮询。**

####  事件轮询

以上过程中，用了三个非阻塞网络调用：一个用于请求，一个用于数据库，还有一个用于响应。

Node 是如何调配这些网络操作的呢？答案是事件轮询（event loop）。

事件轮询是单向运行的先入先出队列，它要经过几个阶段，轮询中每个迭代都要运行的重要阶段：

1. 计时器开始执行。
   1. 这些计时器都是用 JavaScript 函数 setTimeout 和 setInterval 安排好的。
2. 接下来是 I/O 回调，即触发你的回调函数。
   1. 轮询阶段会取获取新的 I/O 事件。
3. 最后是用 setImmediate 安排回调。
   1. 这是一个特例，因为它允许你将安排在当前队列中的 I/O 回调完成后立即执行。

